新添加 魔术笔 模式的实现。总结如下：
1、创建魔术笔模式 Hook：创建了 useMagicPenMode.ts，实现了：
2、在图表上方创建一个透明的 canvas 层，仅在魔术笔模式下显示，鼠标左键长按移动时在 canvas 上实时绘制路径，使用蓝色线条显示绘制轨迹，不影响图表本身
3、单条曲线：直接按鼠标位置添加数据
4、多条曲线：根据开始位置时间获取各曲线在该时间的值，计算平均值作为鼠标轨迹的中间值，根据各曲线与平均值的偏移量还原趋势，如果已有值，直接替换
5、数据间隔固定为 1 分钟



现在完成一件非常有挑战性的 功能，在 数据导入 中增加 一个 趋势生成器（使用独立的模块加载） ，核心就是通过预制 的趋势模块 组合在一起，生成 完整的趋势数据，下面是 具体的功能描述：

UI 排版：弹窗 满屏，最上方 生成数据曲线阅览区（80%高度），中间为 趋势编辑区（10%高度），最下面为 趋势编辑区（10%高度）
生成字段：温度与湿度 通TAB 切换，完全独立的 生成数据曲线阅览区、趋势编辑区

生成数据曲线阅览区：
用于生成数据后 曲线阅览

趋势编辑区：
1、趋势编辑区 用来 放置 不同趋势的模版，可以拖动、调整、向右拖拉 方式调整长度（对应 持续时间），与趋势模版值的修改，类似与 视频 剪辑
2、趋势编辑区 两个模块 不能重叠，如果拖拽时有重叠，自动将当前拖拽对象 放在被重叠的后面
4、编辑区每个模块里面 可以显示 简要的 参数信息，参数通过右击 后弹窗 修改值
5、趋势编辑区 可以添加开始时间（默认值可以通过 曲线图 中 开始时间获取），趋势编辑区 时间 超出后 可以通过X轴滚动条
6、生成数据 只保留1位小数， 时间 都按照 分钟，
3、趋势模版 通过 拖拽的方式 放在 编辑区，放置时 要放在 鼠标对于位置

趋势模版  ：（每个趋势模版都有样式图，趋势模版 这里可以放装一下，后续 有很多趋势模版 的添加）
1、向上趋势：持续时间，开始 值、结束 值
2、向下趋势：持续时间，开始 值、结束 值
3、波浪趋势：持续时间，开始 值、最高值、最高值位置、结束 值
持续时间  使用 时 分 格式 

趋势模版 中 增加 分类TAB切换功能， 将 现在的 分为 基础，在添加一个 行业 标签，增加 下面几种 冷链验证 中必备的曲线：

趋势模版  行业模版 中 需要 将 下面带 值的全部 添加为参数，下面的值都是 默认值，但是 我可以后面调整：

1、预冷曲线（制冷趋势）：基于指数衰减模型，核心参数：初始环境温度 25℃，设定稳定温度 2-8℃，降温速率系数 k=0.02，时间范围 0-4h，负载状态为空载，输出要求：温度随时间单调下降趋势，包含稳定时间（达到 2-8℃的时间）、最终稳定温度（需在 2-8℃内）、温度波动≤±0.5℃

2、预热曲线（制热趋势）：基于指数上升模型，核心参数：初始环境温度 5℃，设定稳定温度 15-25℃，升温速率系数 k=0.018，时间范围 0-3h，负载状态为空载，输出要求：温度随时间单调上升趋势，包含稳定时间（达到 15-25℃的时间）、最终稳定温度（需在 15-25℃内），温度波动≤±0.5℃

3、保温（稳态）曲线：基于高斯噪声 + 稳态模型，核心参数：初始稳定温度 5℃，时间范围 0-24h，输出要求：温度在 5℃±0.5℃内波动的稳态曲线

4、单次开门扰动曲线：基于阶跃扰动 + 指数恢复模型，核心参数：初始稳定温度 5℃，环境温度 28℃，开门持续 1 分钟，响应时间常数 τ1=0.1h，恢复时间常数 τ2=0.25h，时间范围 0-2h，输出要求：温度先上升后下降的趋势，包含开门温度峰值（≤10℃）、关门后恢复至 5℃±0.5℃的时间（≤15 分钟）

5、多次开门扰动曲线：基于多阶跃扰动 + 迭代恢复模型，核心参数：初始稳定温度 5℃，环境温度 28℃，开门次数 4 次，每次开门持续 1 分钟，开门间隔 1.5h，响应时间常数 τ1=0.1h，恢复时间常数 τ2=0.25h，时间范围 0-6h，输出要求：每次开门后温度先上升再下降的趋势，包含每次开门的温度峰值（≤10℃）、关门后恢复至 5℃±0.5℃的时间（≤15 分钟）、累计温度波动，

6、满载曲线：初始环境温度 25℃，设定稳定温度 - 18℃，满载状态（100% 装载水袋模拟货物），货物中心初始温度 25℃，降温速率系数 k=0.015，时间范围 0-8h，输出要求：设备环境温度 + 货物中心温度双曲线，货物中心与环境温度差值≤1℃，满载降温时间≤8h，无局部热点（最高温度≤-18℃）

7、半载曲线：基于指数衰减 + 负载耦合模型，核心参数：初始环境温度 25℃，设定稳定温度 2-8℃，半载状态（50% 装载水袋模拟货物），货物中心初始温度 25℃，降温速率系数 k=0.018，时间范围 0-6h，输出要求：设备环境温度 + 货物中心温度双曲线，货物中心与环境温度差值≤1℃，半载降温时间≤6h，无局部热点（最高温度≤8℃），

8、冷冻曲线（-18℃级）：基于低温指数衰减模型，核心参数：初始环境温度 25℃，设定稳定温度≤-18℃，负载状态为半载，降温速率系数 k=0.012，时间范围 0-10h，输出要求：低温稳定曲线（全程≤-18℃），波动范围 ±1℃，压缩机连续运行下各监测点温度均匀性（温差≤1.5℃），

9、深冷曲线（-25℃级）：基于超低温指数衰减模型，核心参数：初始环境温度 25℃，设定稳定温度≤-25℃，负载状态为半载，降温速率系数 k=0.01，时间范围 0-12h，输出要求：超低温稳定曲线（全程≤-25℃），波动范围 ±1℃，无局部结冰不均（各监测点温差≤2℃），

10、高温应激曲线：基于高温阶跃扰动模型，核心参数：初始稳定温度 5℃，外部高温环境 38℃，时间范围 0-8h，无开门无负载，输出要求：外部温度 38℃下的内部温度响应曲线，内部温度不超过 10℃，稳定恢复时间≤1h，波动范围 ±0.8℃

11、低温应激曲线：基于低温阶跃扰动模型，核心参数：初始稳定温度 15℃，外部低温环境 - 20℃，时间范围 0-8h，无开门无负载，输出要求：外部温度 - 20℃下的内部温度响应曲线，内部温度不低于 10℃，稳定恢复时间≤1h，波动范围 ±0.8℃

12、断电续航曲线（制冷设备）：生成断电续航曲线（制冷设备），基于线性上升 + 衰减模型，核心参数：初始稳定温度 5℃，断电时间点 0h，时间范围 0-6h，负载状态为半载，输出要求：温度随时间上升趋势，上升速率≤0.5℃/h，达到临界温度 10℃的时间≥4h，

13、断电续航曲线（制热设备）：生成断电续航曲线（制热设备），基于线性下降 + 衰减模型，核心参数：初始稳定温度 20℃，断电时间点 0h，时间范围 0-6h，负载状态为半载，输出要求：温度随时间下降趋势，下降速率≤0.5℃/h，达到临界温度 10℃的时间≥4h，

14、循环启停曲线（制冷）：生成循环启停曲线（制冷），基于制冷迭代更新模型，核心参数：设定稳定温度 5℃，初始预冷时间 2h，启停次数 4 次，每次间隔 6h，预冷时间波动 Δ=±5%，输出要求：每次启停的预冷阶段 + 稳定阶段曲线，预冷时间波动≤10%，稳定温度 5℃±0.5℃

15、循环启停曲线（制热）：基于制热迭代更新模型，核心参数：设定稳定温度 20℃，初始预热时间 1.5h，启停次数 4 次，每次间隔 6h，预热时间波动 Δ=±5%，输出要求：每次启停的预热阶段 + 稳定阶段曲线，预热时间波动≤10%，稳定温度 20℃±0.5℃，

16、双温区曲线（冷藏 + 冷冻）：生成双温区曲线（冷藏 + 冷冻），基于双变量耦合模型，核心参数：冷藏区设定温度 2-8℃，冷冻区设定温度≤-18℃，耦合系数 α=0.05，时间范围 0-24h，负载状态为半载，输出要求：两个温区独立温度曲线，冷藏区波动 ±0.5℃、冷冻区波动 ±1℃，温区隔离效果（相邻温差≤5℃）

17、三温区曲线（多温层）：基于多变量耦合模型，核心参数：第一温区设定 0-4℃，第二温区设定 10-15℃，第三温区设定≤-18℃，耦合系数 α=0.05，时间范围 0-24h，负载状态为半载，输出要求：三个温区独立温度曲线，各温区波动 ±0.5℃（低温区 ±1℃），温区隔离效果（相邻温差≤5℃），



现在将 趋势生成器 中的 生成数据 环节进行调整，将 生成数据   改下下一步，然后弹出 数据生成 页面，左边是设备列表，右边是曲线图，设备列表 更具 数据页面 中的 设备管理获取，左击选中，右击取消，选择后才参与渲染，后面设备名称 后面有一个 数值编辑框  用于在  模版数据 趋势中 进行 上下便宜值，可以负数，一位小数点，修改后立即渲染 曲线图，数据生成 页面右下角 有个 立即生效按钮


非常好，继续完善下面问题：
1、从







在模版文档编辑中 右侧增加一个 标签列表 功能，字段有 标签名称、标签描述、标签类型、标签值
UI 排版：标签列表 中每个标签排版  标签名称、更具 标签类型 显示 不同的组件，标签列表 下面 可以 弹窗添加标签按钮


标签类型：
1、文本 输入框
2、数字 输入框（数值校验，小数点后1位）
3、日期 日期选择（日期校验，格式为 YYYY-MM-DD）
4、时间 时间选择（时间校验，格式为 YYYY-MM-DD HH:MM）
5、布点区域 选择（选择区域 如：上层布点、中层布点、下层布点 每个布点 通过 框包起来，在编辑中 回车键 确认，并且 框上面 有 删除图标）
6、布尔 状态选择（true/false）
7、图片 图片 上传（图片校验，格式为图片）
8、CDA 图片 上传（图片校验，格式为图片）
--------------------------------
在TiptapEditor添加 下面功能：
工具栏中 添加 字体颜色、字体大小（一号、小一、二号、小二、一直到 八号 等）、背景颜色、左对齐、居中、右对齐、两端对齐
文本对齐规则优化：使用 innerHTML 而不是 content 参数，保留原始 HTML 结构，避免 Markdown 语法（如 **text**）被重复处理。
Marked 配置优化：添加了 headerIds: false 和 mangle: false 配置，确保能正确解析 HTML 标签内的内容。


在 数据来源菜单 标签值 布点区域 类型中 设置 格式化输出：
前缀：给每一个编号添加前缀  如 001、002, ，如果前缀 为P ，那输出就是 P001、P002
后缀：与前缀同理
输出数量：单选，如果选中， 就是统计 标签的数量，并且 前缀、后缀  输入框 隐藏

--------------------------------
TiptapEditor 内容替换 功能，就是 将文档里面 ，图片类的内容都可以通过 右击弹出 数据来源菜单进行替换，替换后会自动渲染。
数据来源菜单：
1、标签值（文字类、图片类）：标签值 可以 是 文本、数字、日期、时间、布点区域、布尔、图片、CDA 图片，然后替换 标签值 的内容，可以 通过 标签名称 搜索，可以 添加 新添加标签（弹窗 填写标签名称，值为 选中 的值）
2、接口数据（文字类、图片类）：通过请求接口获取数据 获取值并替换。在第一次、修改、重新加载后 请求更新。还要 有接口测试功能，测试成功后 才能 替换。还要 有数据路径（可选）用于从响应中提取特定字段，如：data.items[0].value

详细细节：
数据来源菜单 通过选择选项，不是全部在 一个弹窗里面
有数据来源时文档显示 黄色背景颜色，并且 标签值 会 显示在 文本内容中，鼠标移动到 标签值 上 显示 数据来源 的 详细信息
数据来源菜单 弹窗，点击 其他区域 关闭弹窗
文字类 包含文档中所有文字，表格里面的文本 也能选择 数据来源，文本类一样
对 有数据来源的 内容，左击 可以 修改 标签值，在修改窗口中 可以 删除 数据来源
修改标签后，将关联的文档内容（文字类、图片类） 立即渲染
保存文档后，刷新页面后 ，还要能 获取 标签值，并且 渲染，以及修改数据来源
--------------------------------
将 右侧 增加 布点区域 列表功能，通过TAB切换 布点区域 列表 和 标签列表，在 模版中增加 布点区域 字段。下面是详细功能描述：
布点区域 是一个 列表文本，可以通过 | 分割 多个 布点区域，可以 添加、删除、修改

在编辑文档 工具栏中 添加 字体颜色、字体背景、字体大小、靠左、靠右、居中、单元格 靠上、单元格 居中、单元格 靠下 等基础排版功能

--------------------------------
在编辑文档的 左侧 增加一个目录结构功能，自动获取文档中的 H1、H2、H3 标题，并生成目录结构,下面是详细要求：
1、目录UI 排版：目录结构 中每个标题排版，H1、H2、H3 标题 分别为 一级 二级 三级标题，点击后立即跳转到文档中对应位置
2、目录结构 中每个标题 可以 拖拽 调整顺序，移动的时候 只会移动 当前等级标题 到下一个相同等级标题位置区间的内容，拖拽时 要有 辅助线 动画效果
3、每个目录后有 删除图标， 点击后 只会删除 当前等级标题 到下一个相同等级标题位置区间的内容


--------------------------------
数据来源菜单-标签值 选择对应标签类型，可以配置格式化输出对应标签的值：
时间或日期 类型，可以输出格式化后的时间或日期（默认 YYYY-MM-DD HH:MM:SS）
数字 类型，可以设置保留小数位数（默认 1位）
布尔 类型，可以设置 true/false 值 对应的文本




在数据来源菜单 中 增加下面是详细要求：

时间类：
1、格式化：选择 时间或日期 标签，输出格式化后的时间或日期（默认 YYYY-MM-DD HH:MM:SS）
2、差计算：选择 开始时间 和 结束时间 的标签，计算 时间差，输出时间差（默认 YYYY-MM-DD HH:MM:SS）

测点类：测点数量

在数据来源菜单 中 增加运算类（点击运算类 弹出运算类窗口），下面是详细要求：
运算类：
1、加法：选择 两个 数字类型 标签，计算 两个标签的值 相加 ，可以设置保留小数位数（默认 1位）
2、减法：选择 两个 数字类型 标签，计算 两个标签的值 相减，可以设置保留小数位数（默认 1位）
3、乘法：选择 两个 数字类型 标签，计算 两个标签的值 相乘，可以设置保留小数位数（默认 1位）
4、除法：选择 两个 数字类型 标签，计算 两个标签的值 相除，可以设置保留小数位数（默认 1位）          
5、取余：选择 两个 数字类型 标签，计算 两个标签的值 取余，可以设置保留小数位数（默认 1位）
6、取整：选择 一个 数字类型 标签，计算 一个标签的值 取整，可以设置保留小数位数（默认 1位）
7、取绝对值：选择 一个 数字类型 标签，计算 一个标签的值 取绝对值，可以设置保留小数位数（默认 1位）
8、取最大值：选择 两个 数字类型 标签，计算 两个标签的值 取最大值，可以设置保留小数位数（默认 1位）
9、取最小值：选择 两个 数字类型 标签，计算 两个标签的值 取最小值，可以设置保留小数位数（默认 1位）



温度数据类：
数据小值：选择 温度数据标签，输出 数据小值
数据大值：选择 温度数据标签，输出 数据大值
数据平均值：选择 温度数据标签，输出 数据平均值
数据中位数：选择 温度数据标签，输出 数据中位数
数据众数：选择 温度数据标签，输出 数据众数
数据方差：选择 温度数据标签，输出 数据方差
数据标准差：选择 温度数据标签，输出 数据标准差
数据变异系数：选择 温度数据标签，输出 数据变异系数
数据峰度：选择 温度数据标签，输出 数据峰度
数据偏度：选择 温度数据标签，输出 数据偏度
数据极差：选择 温度数据标签，输出 数据极差
数据范围：选择 温度数据标签，输出 数据范围

湿度数据类：与温度数据类 一样，只是 数据类型 为 湿度

表格类：

在数据来源菜单 中 增加 曲线图类 下面是详细要求：
曲线图类：（也属于 文档中的图片 类型）
必填参数：
选择开始时间： 选择标签（类型为 日期、时间）
选择结束时间： 选择标签（类型为 日期、时间）
温度、湿度 TAB 选择，默认 温度

所有数据来自于 绑定的任务数据中获取，任务数据 通过 任务ID 获取，任务ID 在 模版 中 绑定，如果 没有选择任务ID，则 不执行显示曲线图

里面有添加线条按钮，点击后 弹出 添加线条选择（添加曲线参数、添加平均值曲线参数、添加直线参数） 窗口，
1、添加曲线参数：
选择布点标签：（类型为 布点区域，支持多选，多个布点 用 | 分割，并且 将所选标签所有值去重，标签值 不能为空）
线条宽度：输入线条宽度，默认 2
线条样式：选择线条样式（实线、虚线、点线），默认实线

2、添加平均值曲线参数：
选择布点标签：（类型为 布点区域，支持多选，多个布点 用 | 分割，并且 将所选标签所有值去重，标签值 不能为空）
线条颜色：选择线条颜色，默认 蓝色
线条宽度：输入线条宽度，默认 2
线条样式：选择线条样式（实线、虚线、点线），默认实线

3、添加直线参数：
线条名称：输入线条名称，默认 直线1
线条颜色：选择线条颜色，默认 红色
线条值：输入线条值，默认 8
线条宽度：输入线条宽度，默认 2
线条样式：选择线条样式（实线、虚线、点线），默认虚线

添加后将 曲线图 渲染成 图片上传七牛云，然后替换 对应 曲线图 的 图片


非常好，曲线图 可以优化一下：
1、图例显示 可以优化一下 紧凑点，每列距离 
2、曲线图 可以优化一下 显示 更加 美观，字体放大点，更加 清晰
3、时间 与 值 的 刻度线 使用 虚线显示
4、左侧 值的分布 可以更细化点，太少了，分不清 具体点的值
5、时间轴 刻度时间格式化（月/日 换行 时:分）
6、曲线图 开始 与 结束 时间 必须体现在 曲线图 中
1、曲线图边距 设置最小
2、图例 每列间距 设置最小
3、Y轴标题 放在 左上方
4、X轴标题 不要了

颜色改为黑色（#000000）
标题：24px → 26px
Y轴标签：14px → 16px
Y轴标题：16px → 18px
X轴标签：13px → 15px
图例文本：11px → 13px

曲线图配置 中 增加 阶段备注 功能， 在 线条配置 位置 ，通过TAB切换 阶段备注 和 线条配置，下面是详细要求：
阶段备注功能描述：就是 曲线图 X时间中 备注 每个 阶段 的 时间范围，用于 说明 每个阶段 的 含义，阶段备注有 两种类型：区域备注、时间备注
1、与 线条配置 功能 一样，可以 添加、删除、修改 阶段备注
2、阶段 时间范围 不能超过 曲线图 开始 与 结束 时间

区域备注：
选择开始时间： 选择标签（类型为 日期、时间）
选择结束时间： 选择标签（类型为 日期、时间）
备注内容：输入备注内容
备注颜色：选择备注颜色，默认 蓝色
更具 时间范围 ，在 曲线图 时间轴曲线区域 中用 矩形 框起来（框 为实心，颜色为 备注颜色 调到20%，并透明），左右两边 有 虚线（虚线颜色 与 备注颜色 一致），备注内容 显示在 矩形 上方

时间备注
选择时间位置： 选择标签（类型为 日期、时间）
备注内容：输入备注内容
备注颜色：选择备注颜色，默认 蓝色
更具 选择时间位置 添加 虚线（虚线颜色 与 备注颜色 一致），备注内容 显示在 虚线 上方

--------------------------------

关联任务后 将 任务数据 全部读取到 LokiJS 数据库中，后面 获取 任务数据 从 LokiJS 数据库中获取,b。

--------------------------------
在 页面的上方 增加一个按钮 关联任务（tasks）功能，点击后 弹出 关联任务 窗口，窗口中 左侧显示 分类 右侧显示任务名称，点击任务后 关联任务，关联任务后 将 按钮替换成 关联任务 的 任务名称，
关联任务ID 不用保存到 模版 数据库中，主要用于后续 文档中 数据来源 数据的获取，后续只要是提到 任务数据 都是从中获取。


/tasks/69298d2f0b9c7b60b446dd10/data

/tasks/69298d2f0b9c7b60b446dd10/create  // 生成任务
--------------------------------
布点区域
1、
2、在设备中添加一个 布点区域 字段，并且 将 布点区域 用 | 分割，
3、在 设备编辑中 每个布点区域 用 方框 包起来，在编辑中 回车键 确认，并且 框上面 有 删除图标
4、在 编号的后面显示 布点区域，使用 首字符标识（如：上层布点[上]、中层布点[中]、下层布点[下]），鼠标移动到 布点区域 上 显示 布点区域 的 详细信息


--------------------------------
验证设备校准证书
布局编号	无线温湿度验证设备校准证书编号	验证设备校准有效期至（1）年	备注
001	HLC202504240001	2026-04-23	产品存放区域测点|柜内所有测点|均匀性布点

--------------------------------
表格类：
合并单元格：合并 单元格 功能，点击 合并单元格 按钮，弹出 合并单元格 窗口，窗口中 选择 要合并的 单元格，点击 确定 后 合并 单元格
单元格背景颜色：选择 单元格 背景颜色，默认 白色
导出WORD时，单元格背景颜色 会 应用到 导出的 WORD 中




